# 클로저

- 함수와 함수가 선언된 **어휘적 환경(Lexical)**의 조합이다.
- 이 환경은 클로저가 생성된 시점의 유효범위내에 있는 모든 지역변수로 구성된다.

- Lexical
  - Lexical scoping(어휘적 범위지정) 과정에서 변수가 **어디에서 사용가능한지** 알기 위해 소스코드에서 **어디서 선언되었는지**를 고려한다는 것 

- 자바스크립트는 함수의 중첩을 허용하고 
- 내부함수가 외부함수의 모든 변수와 함수에 접근할수있게 해준다.
  - 외부함수가 접근할 수 있는 모든 변수와 함수들까지!!
- 하지만 외부함수는 내부함수의 변수와 함수에는 접근이 불가능하다.
  - 이는 내부함수에 대해서 **캡슐화**를 제공함



- 클로저는 자신을 포함하고있는 [외부함수의 인자, 지역변수] 등을 외부함수가 종료된 이후에도 사용가능함!!!
  - 이 변수를 **자유변수** 라고함!

- 자바스크립트에서 클로저는 함수가 생성될 때마다 생성됩니다.

- 클로저가 생성될때 범위내의 지역변수들을 자유변수로 만드는걸 **캡쳐**라고함

```js
function outer (){
	var name = 'dolarge';
  	return function () {
		console.log(name); // name은 자유변수
    }
}
      
var inner = outer();
inner(); // 'dolarge
```

`inner`를 실행해보면 `outer`가 끝났는데도 name을 정상적으로 출력이됨! 



클로저를 써서 외부에서 변수에 직접 접근하는것을 제한할수있다.

자유변수를 객체지향언어의 private 멤버변수처럼 사용하는것!(은닉화)

```js
function factory_movie(title){
    return {
        get_title : function (){
            return title;
        },
        set_title : function(_title){
            title = _title
        }
    }
}

var ghost = factory_movie('Ghost in the shell');
var matrix = factory_movie('Matrix');
 
alert(ghost.get_title()); // 'Ghost in the shell'
alert(matrix.get_title()); // 'Matrix'
 
ghost.set_title('공각기동대');
 
alert(ghost.get_title()); // '공각기동대'
alert(matrix.get_title()); // 'Matrix'
```

factory_movie의 title은 set_title을 통해서 변경이가능하다.



```js
var arr = []
for(var i = 0; i < 5; i++){
    arr[i] = function(){
        return i;
    }
}

for(var index in arr) {
    console.log(arr[index]());
}

// 실행결과 5 5 5 5 5
```

console.log 작동하면 i 값은 5라서 5만 출력됨



```js
var arr = []
for(var i = 0; i < 5; i++){
    arr[i] = function(id) {
        return function(){
            return id;
        }
    }(i);
}
for(var index in arr) {
    console.log(arr[index]());
}

// 실행결과 0 1 2 3 4 
```

IIFE(즉시실행함수표현)을 사용해서 원하는 대로 만들수있다.
즉시실행함수의 인자로 i를 넣어주게 되면 외부함수의 id에 i값이 복사되고 자유변수인 id는 for문이 작동하는 시점의 i값을 가지게 된다. 그래서 실행결과가 0 1 2 3 4인것을 볼수있다.



클로저는 계속 자유변수를 참조하고 있기때문에 메모리를 계속 쓰고있다.

그래서 사용이 끝나면 null 처리로 참조를 제거해주자.









> 참고
>
> https://velog.io/@dolarge/Java-Script-%ED%81%B4%EB%A1%9C%EC%A0%80%EB%9E%80
>
> https://velog.io/@proshy/JS%ED%81%B4%EB%A1%9C%EC%A0%B8closure%EC%99%80-%ED%81%B4%EB%A1%9C%EC%A0%B8%EC%9D%98-%EC%82%AC%EC%9A%A9-%EC%98%88%EC%A0%9C
>
> https://developer.mozilla.org/ko/docs/Web/JavaScript/Closures
>
> https://sangkwon2406.tistory.com/46